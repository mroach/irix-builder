pkgname=sudo
pkgver=1.8.27
pkgdesc="Give certain users the ability to run some commands as root"
url="https://www.sudo.ws/sudo/"
license=('custom')
sources=("https://www.sudo.ws/sudo/dist/$pkgname-$pkgver.tar.gz")
sha256sums=('7beb68b94471ef56d8a1036dbcdc09a7b58a949a68ffce48b83f837dd33e2ec0')

build() {
  cd "$pkgname-$pkgver"

  export CFLAGS="-std=gnu11 ${CFLAGS:-}"

  ./configure \
    --host=$TARGET \
    --prefix=$pkgprefix \
    --sbindir=$pkgprefix/usr/bin \
    --libexecdir=$pkgprefix/usr/lib \
    --with-rundir=$pkgprefix/run/sudo \
    --with-vardir=$pkgprefix/var/db/sudo \
    --with-logfac=auth \
    --with-env-editor \
    --with-passprompt="[sudo] password for %p: " \
    --with-insults=disabled \
    --enable-static \
    --enable-static-sudoers \
    --disable-shared \
    --disable-root-sudo \
    --with-timeout

  make
}

package() {
  cd "$pkgname-$pkgver"
  make DESTDIR="$pkgdir" install

  # # Remove sudoers.dist; not needed since pacman manages updates to sudoers
  # rm "$STAGE_ROOT/etc/sudoers.dist"

  # # Remove /run/sudo directory; we create it using systemd-tmpfiles
  # rmdir "$STAGE_ROOT/run/sudo"
  # rmdir "$STAGE_ROOT/run"

  # install -Dm644 "$srcdir/sudo.pam" "$STAGE_ROOT/etc/pam.d/sudo"

  # install -Dm644 doc/LICENSE "$STAGE_ROOT/usr/share/licenses/sudo/LICENSE"
}
